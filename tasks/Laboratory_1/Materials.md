# Полезная информация

#### Что это?

Тут я собрал информацию, которая была для меня полезной, во время решения данной лабораторной работы. 

В процессе решения возникают вопросы, в которых необходимо разобраться. Информаицю я нахожу в интернете, или спрашиваю у нейросетей. 

В случае, если у меня возникает какой-то вопрос, найденную информацию я сохраняю сюда.

---------------------

Что такое **CRT (C Runtime Library)** и почему важно настраивать его использование в проектах на C++.

### Что такое CRT (C Runtime Library)?

**C Runtime Library (CRT)** — это набор стандартных библиотек, которые предоставляют базовую функциональность для программ на C и C++. Это включает в себя такие функции, как выделение памяти, обработка ошибок, ввод/вывод, работу со строками и другие утилиты. В Windows CRT реализован через несколько различных библиотек.

Важный момент: на Windows существует два основных типа CRT, которые могут быть использованы:

1. **Статическая CRT** (`/MT` или `/MTd`):
   
   - Библиотека CRT компилируется прямо в исполнимый файл, то есть весь код библиотеки включается в твой проект.
   
   - При использовании статической CRT каждый проект, который компилируется с этим вариантом, будет иметь свою версию библиотеки.

2. **Динамическая CRT** (`/MD` или `/MDd`):
   
   - Библиотека CRT используется как **динамическая** (DLL). Вместо того чтобы компилировать её в исполнимый файл, твой проект будет ссылаться на внешний файл библиотеки, например, `msvcrt.dll`.
   
   - В этом случае несколько проектов могут использовать одну и ту же версию CRT, которая будет загружена в память при запуске программы.

### Почему важна настройка CRT в проектах?

Когда проект компилируется с использованием одной из этих версий CRT, важно, чтобы все части проекта использовали **одинаковую версию**. Если один проект использует **статическую CRT**, а другой — **динамическую CRT**, это может привести к серьёзным проблемам с совместимостью, особенно при использовании совместных данных, таких как объекты с динамически выделенной памятью.

#### Проблемы, которые могут возникнуть из-за несовпадения CRT:

1. **Дублирование кода**:  
   Если один проект компилируется с **динамической CRT**, а другой с **статической**, то в процессе работы программы может возникнуть ситуация, когда каждый проект будет иметь свою собственную версию CRT. Это может привести к множественному определению одних и тех же функций или даже к ошибкам выполнения.

2. **Проблемы с выделением и освобождением памяти**:  
   Статическая CRT и динамическая CRT имеют свои внутренние механизмы работы с памятью. Например, если один проект выделяет память через динамическую CRT, а другой — через статическую, то освобождение этой памяти может вызвать ошибки, такие как двойное освобождение или утечки памяти, так как каждый проект будет использовать свою "память" для управления динамическими объектами.

3. **Несоответствие параметров компиляции**:  
   Если один проект компилируется с флагом `/MT` (статическая CRT), а другой — с `/MD` (динамическая CRT), то параметры компиляции могут не совпадать, что приведёт к проблемам с линковкой и неопределённому поведению.

### Зачем использовать `gtest_force_shared_crt ON`?

Теперь, когда мы понимаем, что такое CRT и какие проблемы могут возникнуть из-за использования разных вариантов, давай разберём, зачем устанавливается эта строка в CMake:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

Эта строка указывает, что **Google Test (gtest)** должен быть собран с использованием **динамической версии CRT**, даже если проект по умолчанию использует статическую версию.

- **`gtest_force_shared_crt ON`** — это установка флага для библиотеки Google Test, который заставляет её использовать **общую (динамическую) CRT**.

- **`CACHE BOOL "" FORCE`** — это принудительно изменяет значение этого флага, если оно было задано где-то в CMake, гарантируя, что Google Test будет собран с динамической CRT, независимо от того, как настроены другие части проекта.

### Когда это особенно важно?

- **Совместимость с другими библиотеками**: Если твой проект использует другие библиотеки, которые также используют динамическую CRT, то важно, чтобы и Google Test был собран с динамической CRT, чтобы избежать проблем с совместной работой библиотек.

- **Сторонние зависимости**: Если проект зависит от сторонних библиотек (например, библиотека на C++, которая также использует динамическую CRT), и ты используешь Google Test, то важно, чтобы он был собран с той же CRT, чтобы избежать конфликтов.

- **Windows**: Это особенно важно на Windows, потому что там CRT играет более явную роль в работе с памятью и вызовами системных функций.

### Пример сценария:

Допустим, у тебя есть проект, который использует несколько библиотек:

- **Основной проект** компилируется с **динамической CRT** (`/MD`).

- **Google Test** (который ты добавляешь через CMake) по умолчанию собирается с **статической CRT** (`/MT`).

В результате при сборке проекта могут возникнуть проблемы, если ты попытаешься использовать Google Test для тестирования: из-за того, что проект и Google Test используют разные версии CRT, они не смогут корректно обмениваться данными, выделять или освобождать память.

Чтобы избежать этого, ты заставляешь CMake принудительно собирать Google Test с **динамической CRT**, что делает проект совместимым с другими библиотеками, использующими динамическую CRT.

---

### Важно понимать:

- **Статическая CRT**: Хорошо подходит для небольших приложений, где не предполагается использования других библиотек или сложных взаимодействий.

- **Динамическая CRT**: Лучше подходит для больших проектов или для проектов, которые используют сторонние библиотеки, так как она позволяет совместно использовать один экземпляр библиотеки CRT между разными частями программы.

Таким образом, использование `gtest_force_shared_crt ON` помогает избежать проблем с совместимостью в случае, если проект и Google Test должны работать с одной и той же версией CRT.






